<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Kubeadm 搭建 Kubernetes 集群 | 茅屋为秋风所破歌</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="Docker,应用编排,Kubernetes,Systemd,Flannel" />
    
    <meta name="description" content="Overview
本文简单介绍如何利用 Kubeadm 搭建 Kubernetes 1.6.4 集群的方法，网络方案采用Flannel(Overlay)。不对原理和架构有过多阐述和讲解。
废话少说，立马开始！
环境四台机器（CentOS7.1）1234192.168.80.23  (master)192.168.80.24192.168.80.25192.168.80.26
Docker 版本:">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubeadm 搭建 Kubernetes 集群">
<meta property="og:url" content="https://leonlibraries.github.io/2017/06/15/Kubeadm搭建Kubernetes集群/index.html">
<meta property="og:site_name" content="茅屋为秋风所破歌">
<meta property="og:description" content="Overview
本文简单介绍如何利用 Kubeadm 搭建 Kubernetes 1.6.4 集群的方法，网络方案采用Flannel(Overlay)。不对原理和架构有过多阐述和讲解。
废话少说，立马开始！
环境四台机器（CentOS7.1）1234192.168.80.23  (master)192.168.80.24192.168.80.25192.168.80.26
Docker 版本:">
<meta property="og:image" content="https://leonlibraries.github.io/2017/06/15/Kubeadm搭建Kubernetes集群/monitor.jpeg">
<meta property="og:updated_time" content="2017-06-16T03:56:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kubeadm 搭建 Kubernetes 集群">
<meta name="twitter:description" content="Overview
本文简单介绍如何利用 Kubeadm 搭建 Kubernetes 1.6.4 集群的方法，网络方案采用Flannel(Overlay)。不对原理和架构有过多阐述和讲解。
废话少说，立马开始！
环境四台机器（CentOS7.1）1234192.168.80.23  (master)192.168.80.24192.168.80.25192.168.80.26
Docker 版本:">
<meta name="twitter:image" content="https://leonlibraries.github.io/2017/06/15/Kubeadm搭建Kubernetes集群/monitor.jpeg">
    

    
        <link rel="alternate" href="/" title="茅屋为秋风所破歌" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
    
    
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?2be7dcbaf7515622e413315f4dcb7c53";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

    

</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">技术心得分享</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">主页</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/APM/">APM</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/云平台/">云平台</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/代码设计/">代码设计</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/全文搜索/">全文搜索</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/分布式理论/">分布式理论</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/前端那些事儿/">前端那些事儿</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/大数据/">大数据</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/当我们在谈论多线程的时候，我们在谈论什么/">当我们在谈论多线程的时候，我们在谈论什么</a></li></ul>
                                    
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/云平台/">云平台</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-Kubeadm搭建Kubernetes集群" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        Kubeadm 搭建 Kubernetes 集群
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2017/06/15/Kubeadm搭建Kubernetes集群/" class="article-date">
            <time datetime="2017-06-15T02:27:15.000Z" itemprop="datePublished">2017-06-15</time>
        </a>
    </div>

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Docker/">Docker</a>, <a class="tag-link" href="/tags/Flannel/">Flannel</a>, <a class="tag-link" href="/tags/Kubernetes/">Kubernetes</a>, <a class="tag-link" href="/tags/Systemd/">Systemd</a>, <a class="tag-link" href="/tags/应用编排/">应用编排</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p><img src="/2017/06/15/Kubeadm搭建Kubernetes集群/monitor.jpeg" alt=""></p>
<p>本文简单介绍如何利用 Kubeadm 搭建 Kubernetes 1.6.4 集群的方法，网络方案采用Flannel(Overlay)。不对原理和架构有过多阐述和讲解。</p>
<p>废话少说，立马开始！</p>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>四台机器（CentOS7.1）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">192.168.80.23  (master)</div><div class="line">192.168.80.24</div><div class="line">192.168.80.25</div><div class="line">192.168.80.26</div></pre></td></tr></table></figure></p>
<p>Docker 版本: 1.12.3<br>Kubernetes 版本: 1.6.4</p>
<p><strong>PS：确保服务器 yum 安装器可以科学上网</strong></p>
<h3 id="Systemd-系统级进程管理工具，管理-Docker-与-Kubelet"><a href="#Systemd-系统级进程管理工具，管理-Docker-与-Kubelet" class="headerlink" title="Systemd: 系统级进程管理工具，管理 Docker 与 Kubelet"></a>Systemd: 系统级进程管理工具，管理 Docker 与 Kubelet</h3><p>这里不管是 Docker 也好，Kubelet 也罢，都是通过 Systemd 来管理进程的，因此有必要对此做一定的了解。</p>
<p><img src="/2017/06/15/Kubeadm搭建Kubernetes集群/systemd.png" alt="systemd 底层架构"></p>
<p>Systemd 取代了之前 Centos6 init.d 的进程管理方式，然而 Systemd 并不是一个命令，而是一组命令的集合，通过这个集合我们可以对我们的进程进行全方位的控制。当然我们不仅仅可以用 Systemd 管理 docker，我们还可以管理 docker 的容器，但这里不做过多介绍。</p>
<ul>
<li>systemctl: 主命令，管理系统和服务</li>
<li>systemd-analyze: 查看启动耗时</li>
<li>hostnamectl: 查看主机信息</li>
<li>journalctl: 查看服务日志工具</li>
</ul>
<p>可以参考这篇文章 <a href="http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html</a></p>
<h3 id="安装-Docker-（所有节点均要安装）"><a href="#安装-Docker-（所有节点均要安装）" class="headerlink" title="安装 Docker （所有节点均要安装）"></a>安装 Docker （所有节点均要安装）</h3><p>在<a href="https://yum.dockerproject.org/repo/main/centos/7/Packages/" target="_blank" rel="external">官网的 rpm 仓库</a>中找到要下载的 docker 版本 ，然后下载下来并安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget https://yum.dockerproject.org/repo/main/centos/7/Packages/docker-engine-1.12.3-1.el7.centos.x86_64.rpm</div><div class="line"></div><div class="line">yum install docker-engine-1.12.3-1.el7.centos.x86_64.rpm</div></pre></td></tr></table></figure></p>
<p>通过 Systemd 启动 docker<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl enable docker</div><div class="line">systemctl start docker</div></pre></td></tr></table></figure></p>
<p>可以看到 docker 已经安装完毕<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@Node1 ~]# docker version</div><div class="line">Client:</div><div class="line"> Version:      1.12.3</div><div class="line"> API version:  1.24</div><div class="line"> Go version:   go1.6.3</div><div class="line"> Git commit:   6b644ec</div><div class="line"> Built:</div><div class="line"> OS/Arch:      linux/amd64</div><div class="line"></div><div class="line">Server:</div><div class="line"> Version:      1.12.3</div><div class="line"> API version:  1.24</div><div class="line"> Go version:   go1.6.3</div><div class="line"> Git commit:   6b644ec</div><div class="line"> Built:</div><div class="line"> OS/Arch:      linux/amd64</div></pre></td></tr></table></figure></p>
<h3 id="安装-Kubectl-客户端工具-（所有节点均要安装）"><a href="#安装-Kubectl-客户端工具-（所有节点均要安装）" class="headerlink" title="安装 Kubectl 客户端工具 （所有节点均要安装）"></a>安装 Kubectl 客户端工具 （所有节点均要安装）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.6.4/bin/linux/amd64/kubectl</div><div class="line"></div><div class="line">chmod +x ./kubectl</div><div class="line"></div><div class="line">sudo mv ./kubectl /usr/local/bin/kubectl</div></pre></td></tr></table></figure>
<p>安装好就放着，不管先。</p>
<h3 id="安装-Kubeadm-（所有节点均要安装）"><a href="#安装-Kubeadm-（所有节点均要安装）" class="headerlink" title="安装 Kubeadm （所有节点均要安装）"></a>安装 Kubeadm （所有节点均要安装）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</div><div class="line">[kubernetes]</div><div class="line">name=Kubernetes</div><div class="line">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">repo_gpgcheck=1</div><div class="line">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg</div><div class="line">        https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</div><div class="line">EOF</div><div class="line">setenforce 0</div><div class="line">yum install -y kubelet kubeadm kubernetes-cni</div><div class="line">systemctl enable docker &amp;&amp; systemctl start docker</div><div class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet</div></pre></td></tr></table></figure>
<p>这个时候如果科学上网设置正确，就可以顺利完成。</p>
<h3 id="Kubeadm-初始化集群-（Master-节点）"><a href="#Kubeadm-初始化集群-（Master-节点）" class="headerlink" title="Kubeadm 初始化集群 （Master 节点）"></a>Kubeadm 初始化集群 （Master 节点）</h3><h5 id="Docker-代理设置"><a href="#Docker-代理设置" class="headerlink" title="Docker 代理设置"></a>Docker 代理设置</h5><p>上面 yum 已经把要的包安装完了，可以将 yum 的科学上网代理删去，但是需要进一步配置 docker 的科学上网代理，配置方法很简单<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /etc/systemd/system/docker.service.d/http-proxy.conf</div><div class="line"></div><div class="line">[Service]</div><div class="line">Environment=&quot;HTTP_PROXY=http://192.168.80.15:8118/&quot; &quot;NO_PROXY=localhost,127.0.0.1,docker.jcing.com,docker-registry.bluemoon.com.cn&quot;</div></pre></td></tr></table></figure></p>
<p>这里注意要过滤掉本地配置的 Docker 私有镜像库的域名或者 IP 地址，否则私有库用不了。</p>
<p>接着<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl daemon-reload</div><div class="line">systemctl restart docker</div></pre></td></tr></table></figure></p>
<h5 id="预下载镜像，加快初始化进程"><a href="#预下载镜像，加快初始化进程" class="headerlink" title="预下载镜像，加快初始化进程"></a>预下载镜像，加快初始化进程</h5><p>这里列举镜像列表</p>
<table>
<thead>
<tr>
<th>镜像</th>
<th>版本</th>
<th>组件</th>
</tr>
</thead>
<tbody>
<tr>
<td>gcr.io/google_containers/kube-proxy-amd64</td>
<td>v1.6.4</td>
<td>Kubernetes</td>
</tr>
<tr>
<td>gcr.io/google_containers/kube-controller-manager-amd64</td>
<td>v1.6.4</td>
<td>Kubernetes</td>
</tr>
<tr>
<td>gcr.io/google_containers/kube-apiserver-amd64</td>
<td>v1.6.4</td>
<td>Kubernetes</td>
</tr>
<tr>
<td>gcr.io/google_containers/kube-scheduler-amd64</td>
<td>v1.6.4</td>
<td>Kubernetes</td>
</tr>
<tr>
<td>gcr.io/google_containers/etcd-amd64</td>
<td>3.0.17</td>
<td>Kubernetes</td>
</tr>
<tr>
<td>gcr.io/google_containers/pause-amd64</td>
<td>3.0</td>
<td>Kubernetes</td>
</tr>
<tr>
<td>gcr.io/google_containers/k8s-dns-sidecar-amd64</td>
<td>1.14.1</td>
<td>DNS</td>
</tr>
<tr>
<td>gcr.io/google_containers/k8s-dns-kube-dns-amd64</td>
<td>1.14.1</td>
<td>DNS</td>
</tr>
<tr>
<td>gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64</td>
<td>1.14.1</td>
<td>DNS</td>
</tr>
</tbody>
</table>
<h5 id="解除防火墙限制"><a href="#解除防火墙限制" class="headerlink" title="解除防火墙限制"></a>解除防火墙限制</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysctl.conf</div><div class="line"></div><div class="line">net.bridge.bridge-nf-call-ip6tables = 1</div><div class="line">net.bridge.bridge-nf-call-iptables = 1</div></pre></td></tr></table></figure>
<p>接着<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sysctl -p</div></pre></td></tr></table></figure></p>
<h5 id="初始化集群"><a href="#初始化集群" class="headerlink" title="初始化集群"></a>初始化集群</h5><p>我们用 Flannel 作为 Docker 跨 Host 的网络方案，这里初始化的时候要注意多带个参数<code>--pod-network-cidr=10.244.0.0/16</code>（如果用其他网络方案无需携带这个参数）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubeadm init --pod-network-cidr=10.244.0.0/16</div></pre></td></tr></table></figure>
<p>很快，初始化完成，你将会看到这样的信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Your Kubernetes master has initialized successfully!</div><div class="line"></div><div class="line">To start using your cluster, you need to run (as a regular user):</div><div class="line"></div><div class="line">  sudo cp /etc/kubernetes/admin.conf $HOME/</div><div class="line">  sudo chown $(id -u):$(id -g) $HOME/admin.conf</div><div class="line">  export KUBECONFIG=$HOME/admin.conf</div><div class="line"></div><div class="line">You should now deploy a pod network to the cluster.</div><div class="line">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</div><div class="line">  http://kubernetes.io/docs/admin/addons/</div><div class="line"></div><div class="line">You can now join any number of machines by running the following on each node</div><div class="line">as root:</div><div class="line"></div><div class="line">  kubeadm join --token c006b2.4a5ec28edccfe8e3 192.168.80.23:6443</div></pre></td></tr></table></figure></p>
<p>记得要把 token 保留下来，后续增加机器节点需要用到。</p>
<h3 id="配置-Kubectl-客户端工具-（Master-节点）"><a href="#配置-Kubectl-客户端工具-（Master-节点）" class="headerlink" title="配置 Kubectl 客户端工具 （Master 节点）"></a>配置 Kubectl 客户端工具 （Master 节点）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo cp /etc/kubernetes/admin.conf $HOME/</div><div class="line">sudo chown $(id -u):$(id -g) $HOME/admin.conf</div><div class="line">export KUBECONFIG=$HOME/admin.conf</div></pre></td></tr></table></figure>
<p>将 admin.conf 拷贝一份出来，并将路径指定到以<code>KUBECONFIG</code>为 key的环境变量之中，使之生效即可。</p>
<p>admin.conf 内容大概如下</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="attr">apiVersion:</span> v1</div><div class="line"><span class="attr">clusters:</span></div><div class="line"><span class="attr">- cluster:</span></div><div class="line"><span class="attr">    certificate-authority-data:</span> LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRFM01EWXhNakEyTWpJd01Wb1hEVEkzTURZeE1EQTJNakl3TVZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTi9sCmc5VVRNWUpCTmtKTXJnRlZId1J0c2wyd0VHRi8wSXYrRHg5cHJuR2w2WTRtazRzemZWM2diTUZ6QmxiMVA0cWcKY3dNNFpScUE2Ymp3bVVHOElNK29qTGxEYSt5SEYvWTJ4VHIrcHYxMlQ4bTM4WWNXNVJWZEpXUEYyRjZYRGtZNQpKdzNScXZCQ2hIVHFOWjNmM3lqWW0va3pTc0t4SGZQbHIvV2t2UGVpWlZNSXRuVXhlMFJOclZEOGNFMzFlQ2dqCmE2dUhZSXp4T3pKWE5keEhLdVJOMGRmWVlCUmpNTXc1ak1qYVZFZTh6ZkhZMEhqWGx1WjFBdjRmR2tvUnRhdEEKVE5vK3RpZkEzSUZjNXlFMERDeVNLQTBuSWNiVHhQSGUwZ05qU1BhWnJoVjBMSWwwWGZ3S2h3SjllQks3L09pTwpNYytSK0dwRkhrRDlKT3c5RlJrQ0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFJbW82azZ6Z3Rvb2laTTRVNkR2YzVGVU5DU3QKSlp4QnQ3Z2EreEhBSGdjVlFjdUZIK3pqbTViSnVHYzViaDBrWTRlWERVZFptTW5ONHlhc1dXUWs4TVluMEtNWgpXVG9aK2NESlhPUS9RUFdYNUpBamlpRjZrNVlBL0ZRY2RYMG91MFJFSjNmVVllMjR3alZ4TCs2SmdiVmxGcmU2Cm9hUURseXNkSFBCNHVQWFcrcGFGM3lPQmxJd0hjOWhmYVg4K2xkVW80UWZkckxyZDl0TUdrZWZzVjhiSDlpMU8KZlFQOVkvV01ZRU5EcDBLVnRZS1MySnJKaDFmeU4zSXVKck44anV4NGRuYy9Ga2RoZGgzSEhMdHIrQTZ5VVVzaQpTZ3VzcC9tSjJGS0IweG03QkhWK3J1SVVhd3Nmejd2VG9uOURUOWU4MXJZTXBKMEpuOVladWhFTHB1ST0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=</div><div class="line"><span class="attr">    server:</span> https://<span class="number">192.168</span><span class="number">.80</span><span class="number">.23</span>:<span class="number">6443</span></div><div class="line"><span class="attr">  name:</span> kubernetes</div><div class="line"><span class="attr">contexts:</span></div><div class="line"><span class="attr">- context:</span></div><div class="line"><span class="attr">    cluster:</span> kubernetes</div><div class="line"><span class="attr">    user:</span> kubernetes-admin</div><div class="line"><span class="attr">  name:</span> kubernetes-admin@kubernetes</div><div class="line"><span class="attr">current-context:</span> kubernetes-admin@kubernetes</div><div class="line"><span class="attr">kind:</span> Config</div><div class="line"><span class="attr">preferences:</span> &#123;&#125;</div><div class="line"><span class="attr">users:</span></div><div class="line"><span class="attr">- name:</span> kubernetes-admin</div><div class="line"><span class="attr">  user:</span></div><div class="line"><span class="attr">    client-certificate-data:</span> MS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM4akNDQWRxZ0F3SUJBZ0lJZDVvOHpQRlhuYWt3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB4TnpBMk1USXdOakl5TURGYUZ3MHhPREEyTVRJd05qSXlNRE5hTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREVAQnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXB5aTNjUEFRQ3ZzNnIxM3MKeHRxc0pTNGZoU1lrK1dTeitZNDI1QmFlcnBQSi95OFVUOEYzMmhzTlBaN2l1N0UyV09zaFN5Zll3THBpZ0pjUgpHNEdjNUZGMy9abVJlS0FPbXAraC9EazhoamFQL2ZBbkdYWlRja0RrYXd5R2FKVFplVDVjY1NvMG4vQ1lFVGsxCnlWbEVUZVVlMXVUOXNSdDdNc2FFQTJDZXdibUF2T2FHdXhHWjlpMjBPLzBuRG9zT3VJWWJRSC9TcUNyeXBKbUcKbjVVMXh3WkU4d3I3YUVRTlByNjdMSVQwU3V6Smo4blZqYk45L1RjcnkrRWxMNldlajFoU0N4TERXWjVKMzJQVgoxVkREU3IwQmtmOERYMksxTnZOeitPSXc3Q0doSTRsNzVlMlJQRUQ5YnN1bTFodXlNTjR5bCsyOWhJYWZuNXB5CmtGTUxYUUlEQVFBQm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLNU0ra3hGRGlaUkpqMFNNbnlLUXdkNEJ6UXpHOHJDcVprTwpFTUYzb2NmdTNVVXJxeUYrNXVFbCtXQm4vVTFNRDRnMzJEL242RGFmMjE0YXd2enZCdWVETm1GRGs3aVhWYTNPCiszYzd6YWRsczE4QkJUdzlLVnk3NXpORDRLWjJpU1BQQlJPYnBoUmh5dkk3VE14NnNyTFB3NEFwK1hkLzhUWjEKVlZRelRCQnFQc0hCQjRibFJiYS9Udjg0Ti9rK2gzYlJPTnZXOUoyT25GcVlQT1N3ZmszNnNxZDk4ZkEybU80WgpkQXgzYnBWc2plaC9LOUNUdVlNVGRIU05tdDVxOGZ0UkY1MUJGR3RkQW5yZVRuVmVlUHJkN2xMR3JwRzhBejdnCkMweTUyTWl1TkRMeXcxNXgzK0dFdkFRdzMwZWxVenF2UXhFSzM5R1RtUldGblJ6SUkxVT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=</div><div class="line"><span class="attr">    client-key-data:</span> AS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBcHlpM2NQQVFDdnM2cjEzc3h0cXNKUzRmaFNZaytXU3orWTQyNUJhZXJwUEoveThVClQ4RjMyaHNOUFo3aXU3RTJXT3NoU3lmWXdMcGlnSmNSRzRHYzVGRjMvWm1SZUtBT21wK2gvRGs4aGphUC9mQW4KR1haVGNrRGthd3lHYUpUWmVUNWNjU28wbi9DWUVUazF5VmxFVGVVZTF1VDlzUnQ3TXNhRUEyQ2V3Ym1Bdk9hRwp1eEdaOWkyME8vMG5Eb3NPdUlZYlFIL1NxQ3J5cEptR241VTF4d1pFOHdyN2FFUU5QcjY3TElUMFN1ekpqOG5WCmpiTjkvVGNyeStFbEw2V2VqMWhTQ3hMRFdaNUozMlBWMVZERFNyMEJrZjhEWDJLMU52TnorT0l3N0NHaEk0bDcKNWUyUlBFRDlic3VtMWh1eU1ONHlsKzI5aElhZm41cHlrRk1MWFFJREFRQUJBb0lCQUQ5MkxOYTZ2VXg5L3RTdgpVd0pYNkwwZzJxU2hTNjVITmpETGRqbDRBUHlFYlU3dFg4ZTd5clhLU1dlWWw3bnNXSmEvaGQ5VG5HM25GUmgrCndlYndlVkVSUVAzTnZMWFFCbHRidVpMWlpBb01VdlIwcFZOOFljZmhyUmFiSmJnMHNxL2VKaGhzanBnZUxvMXoKYStFcWU4MGE3RzluZG8wendyMFBNdEZaVEV4OWRKNklNMTdZckFLWXZVV01LT1U1WHFqQWUrajF0ck8yall1YQpvVTRKUXZmdDZjVW5OSy9RRjZkSkp1dnpoT1VZQlh1MDB1U2FaK2xQM2VTMm9jeTQwSC83Yk1xY3NVZEd4N0tuCnd3RDNLSlJOUFdhR1N4cHp3TzhCcWtpNENkbFBtVEtNZGxFTTN0cXh3dU1PN0ttWjRkMmlORFVyOHp4VUt2OTgKdFJndk5DRUNnWUVBMW9BVk1kL1BpYW1heFJTZlp6Wm5KYmhQREp0aHNqSlBkaU1ZQ3BUT1M0VDFBTUI0T25ZKwpHVy9MQmtaQlJPZE5aZGdidThOcEZRK0NSU2huVXl4clFQTmszVkZYV0FIdG5rVG9HbldqK2MvVHVlSWFZWFhTCjkzY1E2VGh1SVpTZS85NTUxRDlXYVhuSjZhNU5BNlRsRmN1QU9KTzg0bXFySURtd3UxczdLbWtDZ1lFQXgzL2kKRXBoUlN2Yk93WEo3U05Qb3BaaTAzUzVxNnJvWi9UMXIvZWNXeWRDaCtVQ0JPUkdxQS8wejh1ajU1T2YxMU9EaQpYM1BVVHNiZzJuTlJhNm9lZ0RhTnpaOHp3QUFqLysxckJBN1A3YmFSankxa0VMVG5hMzNkWFJoN2hoMDZtaFlvClB6WmQzZ1hraTc1ckVob2I1Vnd0cHFRVWREL2huY0VPUkRMR2N0VUNnWUVBbG9VNDJrL0pEanhEVEVzbGRNTWIKYkwvQ1VRRjBkQnlUNEQzT01CYXVFUmFTNnQwbFFUa2FhTFVuVGhiYzFHSlAwTWp1NVRyQ01iSTVZeGh3TVZCNQpUeEc5VlFVd2VxU1h2emx4ZXFmVTBvZUJkdTV3UHJYMHZnMENnL1pDYWpRbHd6MjJWamZBQnJJYysydUJ4YTNmCnlBU096S1QzcGhiZVVQWEt6QjdBRFFrQ2dZRUF1Y2JmMnBzWEVLejI2blBXVklKcFlsUHJFUkZacFEzNmg3VjcKN0N3WEw0Wm1YenJ2V3hxVTdUUUwvVWR3OWZZQUdlWDFTQmdQKysvOWtjL1RZV1JCRlBvNFlPUEJDQ25aWEVsVgozNmgvZm9rRjBZUGViQ1JhWU9JTGt0YnFxSUJ0Z3ZIaE5zUkU4eTBmbi9hSnRJaTFzNGQ4UjNNQ1RTTHowYmptCnRTRm5aYVVDZ1lBYS9IWDJNZHcyZTZGZUdmdXZHWE0wenlwNG0rQjFneFlUaFM5eGdlS21QK1VQeDJLa3pQYU0Kc2MzVk1Md1JyY0xIRVZUNHJlVld4MVJQZ1VBQllRWEI0MWlzYlArNFRJWk1MSFZwdG1pL08rdk9nNjF1N2VKOApIV3MvdUxSeWNSdWdtOG55dFZOSFZRcUFTZmRQd2dKYXhoWENSVUYzODZiOHZJOCt0bHhLU2c9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLBo=</div></pre></td></tr></table></figure>
<p>除此之外，kubectl 还提供了一些配置方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">The loading order follows these rules:</div><div class="line"></div><div class="line">  1. If the --kubeconfig flag is set, then only that file is loaded.  The flag may only be set once and no merging takes</div><div class="line">place.</div><div class="line">  2. If $KUBECONFIG environment variable is set, then it is used a list of paths (normal path delimitting rules for your</div><div class="line">system).  These paths are merged.  When a value is modified, it is modified in the file that defines the stanza.  When a</div><div class="line">value is created, it is created in the first file that exists.  If no files in the chain exist, then it creates the last</div><div class="line">file in the list.</div><div class="line">  3. Otherwise, $&#123;HOME&#125;/.kube/config is used and no merging takes place.</div></pre></td></tr></table></figure></p>
<h3 id="安装-Flannel-网络方案：保证-Pod-与-Pod-之间能够相互通信-（Master-节点）"><a href="#安装-Flannel-网络方案：保证-Pod-与-Pod-之间能够相互通信-（Master-节点）" class="headerlink" title="安装 Flannel 网络方案：保证 Pod 与 Pod 之间能够相互通信 （Master 节点）"></a>安装 Flannel 网络方案：保证 Pod 与 Pod 之间能够相互通信 （Master 节点）</h3><p>将下面配置保存成文件 <code>kube-fannel-rbac.yml</code><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Create the clusterrole and clusterrolebinding:</span></div><div class="line"><span class="comment"># $ kubectl create -f kube-flannel-rbac.yml</span></div><div class="line"><span class="comment"># Create the pod using the same namespace used by the flannel serviceaccount:</span></div><div class="line"><span class="comment"># $ kubectl create --namespace kube-system -f kube-flannel.yml</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="attr">kind:</span> ClusterRole</div><div class="line"><span class="attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  name:</span> flannel</div><div class="line"><span class="attr">rules:</span></div><div class="line"><span class="attr">  - apiGroups:</span></div><div class="line"><span class="bullet">      -</span> <span class="string">""</span></div><div class="line"><span class="attr">    resources:</span></div><div class="line"><span class="bullet">      -</span> pods</div><div class="line"><span class="attr">    verbs:</span></div><div class="line"><span class="bullet">      -</span> get</div><div class="line"><span class="attr">  - apiGroups:</span></div><div class="line"><span class="bullet">      -</span> <span class="string">""</span></div><div class="line"><span class="attr">    resources:</span></div><div class="line"><span class="bullet">      -</span> nodes</div><div class="line"><span class="attr">    verbs:</span></div><div class="line"><span class="bullet">      -</span> list</div><div class="line"><span class="bullet">      -</span> watch</div><div class="line"><span class="attr">  - apiGroups:</span></div><div class="line"><span class="bullet">      -</span> <span class="string">""</span></div><div class="line"><span class="attr">    resources:</span></div><div class="line"><span class="bullet">      -</span> nodes/status</div><div class="line"><span class="attr">    verbs:</span></div><div class="line"><span class="bullet">      -</span> patch</div><div class="line"><span class="meta">---</span></div><div class="line"><span class="attr">kind:</span> ClusterRoleBinding</div><div class="line"><span class="attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  name:</span> flannel</div><div class="line"><span class="attr">roleRef:</span></div><div class="line"><span class="attr">  apiGroup:</span> rbac.authorization.k8s.io</div><div class="line"><span class="attr">  kind:</span> ClusterRole</div><div class="line"><span class="attr">  name:</span> flannel</div><div class="line"><span class="attr">subjects:</span></div><div class="line"><span class="attr">- kind:</span> ServiceAccount</div><div class="line"><span class="attr">  name:</span> flannel</div><div class="line"><span class="attr">  namespace:</span> kube-system</div></pre></td></tr></table></figure></p>
<p>将以下配置保存成文件 <code>kube-fannel.yml</code><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line"><span class="meta">---</span></div><div class="line"><span class="attr">apiVersion:</span> v1</div><div class="line"><span class="attr">kind:</span> ServiceAccount</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  name:</span> flannel</div><div class="line"><span class="attr">  namespace:</span> kube-system</div><div class="line"><span class="meta">---</span></div><div class="line"><span class="attr">kind:</span> ConfigMap</div><div class="line"><span class="attr">apiVersion:</span> v1</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  name:</span> kube-flannel-cfg</div><div class="line"><span class="attr">  namespace:</span> kube-system</div><div class="line"><span class="attr">  labels:</span></div><div class="line"><span class="attr">    tier:</span> node</div><div class="line"><span class="attr">    app:</span> flannel</div><div class="line"><span class="attr">data:</span></div><div class="line">  cni-conf.json: <span class="string">|</span></div><div class="line">    &#123;</div><div class="line">      "name": "cbr0",</div><div class="line">      "type": "flannel",</div><div class="line">      "delegate": &#123;</div><div class="line">        "isDefaultGateway": true</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  net-conf.json: |</div><div class="line">    &#123;</div><div class="line">      "Network": "10.244.0.0/16",</div><div class="line">      "Backend": &#123;</div><div class="line">        "Type": "vxlan"</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">---</div><div class="line"><span class="attr">apiVersion:</span> extensions/v1beta1</div><div class="line"><span class="attr">kind:</span> DaemonSet</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  name:</span> kube-flannel-ds</div><div class="line"><span class="attr">  namespace:</span> kube-system</div><div class="line"><span class="attr">  labels:</span></div><div class="line"><span class="attr">    tier:</span> node</div><div class="line"><span class="attr">    app:</span> flannel</div><div class="line"><span class="attr">spec:</span></div><div class="line"><span class="attr">  template:</span></div><div class="line"><span class="attr">    metadata:</span></div><div class="line"><span class="attr">      labels:</span></div><div class="line"><span class="attr">        tier:</span> node</div><div class="line"><span class="attr">        app:</span> flannel</div><div class="line"><span class="attr">    spec:</span></div><div class="line"><span class="attr">      hostNetwork:</span> <span class="literal">true</span></div><div class="line"><span class="attr">      nodeSelector:</span></div><div class="line">        beta.kubernetes.io/arch: amd64</div><div class="line"><span class="attr">      tolerations:</span></div><div class="line"><span class="attr">      - key:</span> node-role.kubernetes.io/master</div><div class="line"><span class="attr">        operator:</span> Exists</div><div class="line"><span class="attr">        effect:</span> NoSchedule</div><div class="line"><span class="attr">      serviceAccountName:</span> flannel</div><div class="line"><span class="attr">      containers:</span></div><div class="line"><span class="attr">      - name:</span> kube-flannel</div><div class="line"><span class="attr">        image:</span> quay.io/coreos/flannel:v0<span class="number">.7</span><span class="number">.1</span>-amd64</div><div class="line"><span class="attr">        command:</span> [ <span class="string">"/opt/bin/flanneld"</span>, <span class="string">"--ip-masq"</span>, <span class="string">"--kube-subnet-mgr"</span> ]</div><div class="line"><span class="attr">        securityContext:</span></div><div class="line"><span class="attr">          privileged:</span> <span class="literal">true</span></div><div class="line"><span class="attr">        env:</span></div><div class="line"><span class="attr">        - name:</span> POD_NAME</div><div class="line"><span class="attr">          valueFrom:</span></div><div class="line"><span class="attr">            fieldRef:</span></div><div class="line"><span class="attr">              fieldPath:</span> metadata.name</div><div class="line"><span class="attr">        - name:</span> POD_NAMESPACE</div><div class="line"><span class="attr">          valueFrom:</span></div><div class="line"><span class="attr">            fieldRef:</span></div><div class="line"><span class="attr">              fieldPath:</span> metadata.namespace</div><div class="line"><span class="attr">        volumeMounts:</span></div><div class="line"><span class="attr">        - name:</span> run</div><div class="line"><span class="attr">          mountPath:</span> /run</div><div class="line"><span class="attr">        - name:</span> flannel-cfg</div><div class="line"><span class="attr">          mountPath:</span> /etc/kube-flannel/</div><div class="line"><span class="attr">      - name:</span> install-cni</div><div class="line"><span class="attr">        image:</span> quay.io/coreos/flannel:v0<span class="number">.7</span><span class="number">.1</span>-amd64</div><div class="line"><span class="attr">        command:</span> [ <span class="string">"/bin/sh"</span>, <span class="string">"-c"</span>, <span class="string">"set -e -x; cp -f /etc/kube-flannel/cni-conf.json /etc/cni/net.d/10-flannel.conf; while true; do sleep 3600; done"</span> ]</div><div class="line"><span class="attr">        volumeMounts:</span></div><div class="line"><span class="attr">        - name:</span> cni</div><div class="line"><span class="attr">          mountPath:</span> /etc/cni/net.d</div><div class="line"><span class="attr">        - name:</span> flannel-cfg</div><div class="line"><span class="attr">          mountPath:</span> /etc/kube-flannel/</div><div class="line"><span class="attr">      volumes:</span></div><div class="line"><span class="attr">        - name:</span> run</div><div class="line"><span class="attr">          hostPath:</span></div><div class="line"><span class="attr">            path:</span> /run</div><div class="line"><span class="attr">        - name:</span> cni</div><div class="line"><span class="attr">          hostPath:</span></div><div class="line"><span class="attr">            path:</span> /etc/cni/net.d</div><div class="line"><span class="attr">        - name:</span> flannel-cfg</div><div class="line"><span class="attr">          configMap:</span></div><div class="line"><span class="attr">            name:</span> kube-flannel-cfg</div></pre></td></tr></table></figure></p>
<p>接着执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">kubectl create -f kube-fannel-rbac.yml</div><div class="line">kubectl apply -f kube-fannel.yml</div></pre></td></tr></table></figure></p>
<p>即可。<br>到这一步为止，Master 节点的安装过程完毕。</p>
<h3 id="新增机器节点-（其余-Node-节点）"><a href="#新增机器节点-（其余-Node-节点）" class="headerlink" title="新增机器节点 （其余 Node 节点）"></a>新增机器节点 （其余 Node 节点）</h3><p>新机器的 Kubeadm 是已经装好了的，Docker 代理也是要配置的，镜像最好也是要预先拉取的，拉取的镜像和上边一致。准备工作完成之后就可以执行如下指令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubeadm join --token c016b2.4a3ec28edccfe8e3 192.168.80.23:6443</div></pre></td></tr></table></figure>
<p>很快，节点添加完毕！<br>在 Master 节点执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@Node1 ~]# kubectl get nodes</div><div class="line">NAME    STATUS    AGE       VERSION</div><div class="line">Node1   Ready     3d        v1.6.4</div><div class="line">Node2   Ready     3d        v1.6.4</div><div class="line">Node3   Ready     2d        v1.6.4</div><div class="line">Node4   Ready     2d        v1.6.4</div></pre></td></tr></table></figure></p>
<p>节点信息状态为<code>Ready</code>表示节点加入成功。</p>
<h3 id="安装-Dashboard-（Master-节点）"><a href="#安装-Dashboard-（Master-节点）" class="headerlink" title="安装 Dashboard （Master 节点）"></a>安装 Dashboard （Master 节点）</h3><p>将以下配置保存成文件 <code>kube-dashboard.yml</code><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Copyright 2015 Google Inc. All Rights Reserved.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Licensed under the Apache License, Version 2.0 (the "License");</span></div><div class="line"><span class="comment"># you may not use this file except in compliance with the License.</span></div><div class="line"><span class="comment"># You may obtain a copy of the License at</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></div><div class="line"><span class="comment"># distributed under the License is distributed on an "AS IS" BASIS,</span></div><div class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div><div class="line"><span class="comment"># See the License for the specific language governing permissions and</span></div><div class="line"><span class="comment"># limitations under the License.</span></div><div class="line"></div><div class="line"><span class="comment"># Configuration to deploy release version of the Dashboard UI compatible with</span></div><div class="line"><span class="comment"># Kubernetes 1.6 (RBAC enabled).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Example usage: kubectl create -f &lt;this_file&gt;</span></div><div class="line"></div><div class="line"><span class="attr">apiVersion:</span> v1</div><div class="line"><span class="attr">kind:</span> ServiceAccount</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  labels:</span></div><div class="line"><span class="attr">    k8s-app:</span> kubernetes-dashboard</div><div class="line"><span class="attr">  name:</span> kubernetes-dashboard</div><div class="line"><span class="attr">  namespace:</span> kube-system</div><div class="line"><span class="meta">---</span></div><div class="line"><span class="attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1</div><div class="line"><span class="attr">kind:</span> ClusterRoleBinding</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  name:</span> kubernetes-dashboard</div><div class="line"><span class="attr">  labels:</span></div><div class="line"><span class="attr">    k8s-app:</span> kubernetes-dashboard</div><div class="line"><span class="attr">roleRef:</span></div><div class="line"><span class="attr">  apiGroup:</span> rbac.authorization.k8s.io</div><div class="line"><span class="attr">  kind:</span> ClusterRole</div><div class="line"><span class="attr">  name:</span> cluster-admin</div><div class="line"><span class="attr">subjects:</span></div><div class="line"><span class="attr">- kind:</span> ServiceAccount</div><div class="line"><span class="attr">  name:</span> kubernetes-dashboard</div><div class="line"><span class="attr">  namespace:</span> kube-system</div><div class="line"><span class="meta">---</span></div><div class="line"><span class="attr">kind:</span> Deployment</div><div class="line"><span class="attr">apiVersion:</span> extensions/v1beta1</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  labels:</span></div><div class="line"><span class="attr">    k8s-app:</span> kubernetes-dashboard</div><div class="line"><span class="attr">  name:</span> kubernetes-dashboard</div><div class="line"><span class="attr">  namespace:</span> kube-system</div><div class="line"><span class="attr">spec:</span></div><div class="line"><span class="attr">  replicas:</span> <span class="number">1</span></div><div class="line"><span class="attr">  revisionHistoryLimit:</span> <span class="number">10</span></div><div class="line"><span class="attr">  selector:</span></div><div class="line"><span class="attr">    matchLabels:</span></div><div class="line"><span class="attr">      k8s-app:</span> kubernetes-dashboard</div><div class="line"><span class="attr">  template:</span></div><div class="line"><span class="attr">    metadata:</span></div><div class="line"><span class="attr">      labels:</span></div><div class="line"><span class="attr">        k8s-app:</span> kubernetes-dashboard</div><div class="line"><span class="attr">    spec:</span></div><div class="line"><span class="attr">      containers:</span></div><div class="line"><span class="attr">      - name:</span> kubernetes-dashboard</div><div class="line"><span class="attr">        image:</span> gcr.io/google_containers/kubernetes-dashboard-amd64:v1<span class="number">.6</span><span class="number">.1</span></div><div class="line"><span class="attr">        ports:</span></div><div class="line"><span class="attr">        - containerPort:</span> <span class="number">9090</span></div><div class="line"><span class="attr">          protocol:</span> TCP</div><div class="line"><span class="attr">        args:</span></div><div class="line">          <span class="comment"># Uncomment the following line to manually specify Kubernetes API server Host</span></div><div class="line">          <span class="comment"># If not specified, Dashboard will attempt to auto discover the API server and connect</span></div><div class="line">          <span class="comment"># to it. Uncomment only if the default does not work.</span></div><div class="line">          <span class="comment"># - --apiserver-host=http://my-address:port</span></div><div class="line"><span class="attr">        livenessProbe:</span></div><div class="line"><span class="attr">          httpGet:</span></div><div class="line"><span class="attr">            path:</span> /</div><div class="line"><span class="attr">            port:</span> <span class="number">9090</span></div><div class="line"><span class="attr">          initialDelaySeconds:</span> <span class="number">30</span></div><div class="line"><span class="attr">          timeoutSeconds:</span> <span class="number">30</span></div><div class="line"><span class="attr">      serviceAccountName:</span> kubernetes-dashboard</div><div class="line">      <span class="comment"># Comment the following tolerations if Dashboard must not be deployed on master</span></div><div class="line"><span class="attr">      tolerations:</span></div><div class="line"><span class="attr">      - key:</span> node-role.kubernetes.io/master</div><div class="line"><span class="attr">        effect:</span> NoSchedule</div><div class="line"><span class="meta">---</span></div><div class="line"><span class="attr">kind:</span> Service</div><div class="line"><span class="attr">apiVersion:</span> v1</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  labels:</span></div><div class="line"><span class="attr">    k8s-app:</span> kubernetes-dashboard</div><div class="line"><span class="attr">  name:</span> kubernetes-dashboard</div><div class="line"><span class="attr">  namespace:</span> kube-system</div><div class="line"><span class="attr">spec:</span></div><div class="line"><span class="attr">  ports:</span></div><div class="line"><span class="attr">  - port:</span> <span class="number">80</span></div><div class="line"><span class="attr">    targetPort:</span> <span class="number">9090</span></div><div class="line"><span class="attr">  selector:</span></div><div class="line"><span class="attr">    k8s-app:</span> kubernetes-dashboard</div></pre></td></tr></table></figure></p>
<p>接着执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl create -f kube-dashboard.yml</div></pre></td></tr></table></figure></p>
<p>这里可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl proxy</div></pre></td></tr></table></figure></p>
<p>默认绑定8001端口，且只允许本机访问，如果想要全世界都能访问就得加个启动参数<code>--accept-hosts=&#39;^*$&#39; &amp;</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nohup kubectl proxy --address=&apos;192.168.80.23&apos; --port=8989 --accept-hosts=&apos;^*$&apos; &amp;</div></pre></td></tr></table></figure></p>
<p>这时候就能访问 Dashboard 了。<br><img src="/2017/06/15/Kubeadm搭建Kubernetes集群/dashboard.jpeg" alt="仪表盘"></p>
<h3 id="增加-Heapster-支持（Master-节点）"><a href="#增加-Heapster-支持（Master-节点）" class="headerlink" title="增加 Heapster 支持（Master 节点）"></a>增加 Heapster 支持（Master 节点）</h3><p>Heapster 是 Kubernetes 的一个监控组件，基于 Grafana 和 influxdb 实现，我们这里安装的是1.3.0的版本，安装步骤如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/kubernetes/heapster/archive/v1.3.0.tar.gz</div><div class="line"></div><div class="line">tar -zxvf v1.3.0.tar.gz</div><div class="line"></div><div class="line">kubectl create -f heapster-1.3.0/deploy/kube-config/influxdb</div></pre></td></tr></table></figure></p>
<p>等待 pod 变为 Running 状态，便安装成功<br><img src="/2017/06/15/Kubeadm搭建Kubernetes集群/monitor.jpeg" alt="监控仪表盘"></p>
<h3 id="官方用例部署"><a href="#官方用例部署" class="headerlink" title="官方用例部署"></a>官方用例部署</h3><p>官方演示了一个袜子商城，以微服务的形式部署起来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">kubectl create namespace sock-shop</div><div class="line"></div><div class="line">kubectl apply -n sock-shop -f &quot;https://github.com/microservices-demo/microservices-demo/blob/master/deploy/kubernetes/complete-demo.yaml?raw=true&quot;</div></pre></td></tr></table></figure></p>
<p>同样，等待 Pod 变为 Running 状态，便安装成功<br><img src="/2017/06/15/Kubeadm搭建Kubernetes集群/demo.jpeg" alt="官方用例"></p>
<p>我们可以看到这个商城拆分成了许多微服务模块，支付、用户、订单以及购物车等等。我们接下来访问一下他的前端，如果功能能通，就说明跨主机网络访问是能跑通的。</p>
<p>我们可以看到 front-end 模块绑定的 nodePort 是 30001</p>
<p><img src="/2017/06/15/Kubeadm搭建Kubernetes集群/nodeport.jpeg" alt=""></p>
<p>访问 <a href="http://192.168.80.25:30001" target="_blank" rel="external">http://192.168.80.25:30001</a> 即可看到如下画面<br><img src="/2017/06/15/Kubeadm搭建Kubernetes集群/sockshop.jpeg" alt=""></p>
<p>如果加购物车功能能够跑通，就说明集群搭建成功，没毛病。</p>
<h3 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h3><p>安装过程中不免遇到一些障碍，这里稍作总结：</p>
<h5 id="Q1"><a href="#Q1" class="headerlink" title="Q1"></a>Q1</h5><p>Kubeadm init 过程中卡在 <code>[apiclient] Created API client, waiting for the control plane to become ready</code> 这句话十分长时间，这个时候通过命令<code>sudo journalctl -r -u kubelet</code>发现日志有这么一句话：<br><code>kubelet cgroup driver: &quot;cgroupfs&quot; is different from docker cgroup driver: “systemd&quot;</code></p>
<p>解决办法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/systemd/system/kubelet.service.d/10-kubeadm.conf</div></pre></td></tr></table></figure></p>
<p>将<br>–cgroup-driver=<code>systemd</code> 修改为 <code>cgroupfs</code>即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl daemon-reload</div></pre></td></tr></table></figure></p>
<h5 id="Q2"><a href="#Q2" class="headerlink" title="Q2"></a>Q2</h5><p>继续上个情况，依然在那个地方卡停很久无动静，观察 kubelet 日志中有如下错误：</p>
<p><code>Unable to update cni config: No networks found in /etc/cni/net.d</code></p>
<p>而此时 kubelet 进程已经在跑，API Server 本身启动成功没有报错，而 Controller Manager 在连接 API Server 的时候貌似不通，报出<code>TLS handshake timeout</code>错误。</p>
<p>解决办法：</p>
<p>这种情况考虑是开了系统代理导致，由于可能是全局代理，导致 IP 访问API Server 也是不通的，通常建议此时关闭系统代理，仅仅开启 Docker 代理就足够应付接下来的安装。</p>
<h5 id="Q3"><a href="#Q3" class="headerlink" title="Q3"></a>Q3</h5><p>使用 kubectl 报出 <code>The connection to the server localhost:8080 was refused - did you specify the right host or port?</code></p>
<p>说明 kubectl 配置不成功，解决办法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo cp /etc/kubernetes/admin.conf $HOME/</div><div class="line">sudo chown $(id -u):$(id -g) $HOME/admin.conf</div><div class="line">export KUBECONFIG=$HOME/admin.conf</div></pre></td></tr></table></figure></p>
<h5 id="Q4"><a href="#Q4" class="headerlink" title="Q4"></a>Q4</h5><p>安装 flannel 后报出<code>kubeadm 1.6.0 I created pods network failed,kube-flannel CrashLoopBackOff</code></p>
<p>解决办法：<br>这种情况是权限导致的，务必要执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl create -f kube-flannel-rbac.yml</div></pre></td></tr></table></figure></p>
<p>具体配置内容参考上边 flannel 安装步骤。</p>
<h5 id="Q5"><a href="#Q5" class="headerlink" title="Q5"></a>Q5</h5><p>安装 Heapster 成功后，Heapster Pods 报出错误：<br><code>E0616 03:07:54.563464       1 reflector.go:203] k8s.io/heapster/metrics/heapster.go:327: Failed to list *api.Node: the server does not allow access to the requested resource (get nodes)</code></p>
<p>解决办法：</p>
<p>RBAC 权限问题，另外要将 heapster 版本从 v1.3.0-beta.1 升级到 v1.3.0</p>
<p>（对应的镜像就是 gcr.io/google_containers/heapster-amd64:v1.3.0）</p>
<p>官网给出了最新的安装实践，只需要将 heapster 的 Deployments 和 Servies 删除即可</p>
<p>将如下配置保存成 heapster-deployments.yml<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="attr">apiVersion:</span> v1</div><div class="line"><span class="attr">kind:</span> ServiceAccount</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  name:</span> heapster</div><div class="line"><span class="attr">  namespace:</span> kube-system</div><div class="line"><span class="meta">---</span></div><div class="line"><span class="attr">apiVersion:</span> extensions/v1beta1</div><div class="line"><span class="attr">kind:</span> Deployment</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  name:</span> heapster</div><div class="line"><span class="attr">  namespace:</span> kube-system</div><div class="line"><span class="attr">spec:</span></div><div class="line"><span class="attr">  replicas:</span> <span class="number">1</span></div><div class="line"><span class="attr">  template:</span></div><div class="line"><span class="attr">    metadata:</span></div><div class="line"><span class="attr">      labels:</span></div><div class="line"><span class="attr">        task:</span> monitoring</div><div class="line"><span class="attr">        k8s-app:</span> heapster</div><div class="line"><span class="attr">    spec:</span></div><div class="line"><span class="attr">      serviceAccountName:</span> heapster</div><div class="line"><span class="attr">      containers:</span></div><div class="line"><span class="attr">      - name:</span> heapster</div><div class="line"><span class="attr">        image:</span> gcr.io/google_containers/heapster-amd64:v1<span class="number">.3</span><span class="number">.0</span></div><div class="line"><span class="attr">        imagePullPolicy:</span> IfNotPresent</div><div class="line"><span class="attr">        command:</span></div><div class="line"><span class="bullet">        -</span> /heapster</div><div class="line"><span class="bullet">        -</span> --source=kubernetes:https://kubernetes.default</div><div class="line"><span class="bullet">        -</span> --sink=influxdb:http://monitoring-influxdb.kube-system.svc:<span class="number">8086</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="attr">apiVersion:</span> v1</div><div class="line"><span class="attr">kind:</span> Service</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  labels:</span></div><div class="line"><span class="attr">    task:</span> monitoring</div><div class="line">    <span class="comment"># For use as a Cluster add-on (https://github.com/kubernetes/kubernetes/tree/master/cluster/addons)</span></div><div class="line">    <span class="comment"># If you are NOT using this as an addon, you should comment out this line.</span></div><div class="line">    kubernetes.io/cluster-service: <span class="string">'true'</span></div><div class="line">    kubernetes.io/name: Heapster</div><div class="line"><span class="attr">  name:</span> heapster</div><div class="line"><span class="attr">  namespace:</span> kube-system</div><div class="line"><span class="attr">spec:</span></div><div class="line"><span class="attr">  ports:</span></div><div class="line"><span class="attr">  - port:</span> <span class="number">80</span></div><div class="line"><span class="attr">    targetPort:</span> <span class="number">8082</span></div><div class="line"><span class="attr">  selector:</span></div><div class="line"><span class="attr">    k8s-app:</span> heapster</div></pre></td></tr></table></figure></p>
<p>接着执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl create -f heapster-deployments.yml</div></pre></td></tr></table></figure></p>
<p>即可。</p>
<p>done.</p>
<p>Further Reading<br><a href="http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html</a><br><a href="http://blog.frognew.com/2017/04/kubeadm-install-kubernetes-1.6.html#安装pod-network" target="_blank" rel="external">http://blog.frognew.com/2017/04/kubeadm-install-kubernetes-1.6.html#安装pod-network</a></p>

        </div>
        <footer class="article-footer">
            

    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间">QQ空间</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
    <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博">腾讯微博</a>
    <a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网">人人网</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>



        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/leonlibraries" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/" target="_blank">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
    
        <a href="/2017/05/18/从LSM到HBase/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">从 LSM Tree 到 HBase</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/06/15/Kubeadm搭建Kubernetes集群/" class="thumbnail">
    
    
        <span style="background-image:url(/2017/06/15/Kubeadm搭建Kubernetes集群/monitor.jpeg)" alt="Kubeadm 搭建 Kubernetes 集群" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/云平台/">云平台</a></p>
                            <p class="item-title"><a href="/2017/06/15/Kubeadm搭建Kubernetes集群/" class="title">Kubeadm 搭建 Kubernetes 集群</a></p>
                            <p class="item-date"><time datetime="2017-06-15T02:27:15.000Z" itemprop="datePublished">2017-06-15</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/05/18/从LSM到HBase/" class="thumbnail">
    
    
        <span style="background-image:url(/2017/05/18/从LSM到HBase/LSM_Tree.png)" alt="从 LSM Tree 到 HBase" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/分布式理论/">分布式理论</a></p>
                            <p class="item-title"><a href="/2017/05/18/从LSM到HBase/" class="title">从 LSM Tree 到 HBase</a></p>
                            <p class="item-date"><time datetime="2017-05-18T02:27:15.000Z" itemprop="datePublished">2017-05-18</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/04/27/ElasticSearch内部机制浅析三/" class="thumbnail">
    
    
        <span style="background-image:url(/2017/04/27/ElasticSearch内部机制浅析三/segments.jpg)" alt="ElasticSearch 内部机制浅析（三）" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/大数据/">大数据</a></p>
                            <p class="item-title"><a href="/2017/04/27/ElasticSearch内部机制浅析三/" class="title">ElasticSearch 内部机制浅析（三）</a></p>
                            <p class="item-date"><time datetime="2017-04-27T09:00:15.000Z" itemprop="datePublished">2017-04-27</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/04/20/ElasticSearch内部机制浅析二/" class="thumbnail">
    
    
        <span style="background-image:url(/2017/04/20/ElasticSearch内部机制浅析二/cap.jpg)" alt="ElasticSearch 内部机制浅析（二）" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/大数据/">大数据</a></p>
                            <p class="item-title"><a href="/2017/04/20/ElasticSearch内部机制浅析二/" class="title">ElasticSearch 内部机制浅析（二）</a></p>
                            <p class="item-date"><time datetime="2017-04-20T09:00:15.000Z" itemprop="datePublished">2017-04-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/04/15/ElasticSearch内部机制浅析一/" class="thumbnail">
    
    
        <span style="background-image:url(/2017/04/15/ElasticSearch内部机制浅析一/framework.jpg)" alt="ElasticSearch 内部机制浅析（一）" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/大数据/">大数据</a></p>
                            <p class="item-title"><a href="/2017/04/15/ElasticSearch内部机制浅析一/" class="title">ElasticSearch 内部机制浅析（一）</a></p>
                            <p class="item-date"><time datetime="2017-04-15T04:00:15.000Z" itemprop="datePublished">2017-04-15</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/APM/">APM</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/云平台/">云平台</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/代码设计/">代码设计</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/全文搜索/">全文搜索</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式理论/">分布式理论</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端那些事儿/">前端那些事儿</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/当我们在谈论多线程的时候，我们在谈论什么/">当我们在谈论多线程的时候，我们在谈论什么</a><span class="category-list-count">2</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">2</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CDH/">CDH</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECMAScript6/">ECMAScript6</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flannel/">Flannel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HBase/">HBase</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/">Hadoop</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kubernetes/">Kubernetes</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LSM/">LSM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lucene/">Lucene</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Relay/">Relay</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/StupidIE/">StupidIE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Systemd/">Systemd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/full-text-search/">full-text search</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lucene/">lucene</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web前端/">web前端</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/代码设计/">代码设计</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/全文搜索/">全文搜索</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式算法/">分布式算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端组件化/">前端组件化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/图片搜索/">图片搜索</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程/">多线程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大数据/">大数据</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/干货/">干货</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/并发编程/">并发编程</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/应用编排/">应用编排</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/模块化/">模块化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/监控/">监控</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面向对象/">面向对象</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/CDH/" style="font-size: 10px;">CDH</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/ECMAScript6/" style="font-size: 15px;">ECMAScript6</a> <a href="/tags/Flannel/" style="font-size: 10px;">Flannel</a> <a href="/tags/HBase/" style="font-size: 15px;">HBase</a> <a href="/tags/Hadoop/" style="font-size: 12.5px;">Hadoop</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Kubernetes/" style="font-size: 10px;">Kubernetes</a> <a href="/tags/LSM/" style="font-size: 10px;">LSM</a> <a href="/tags/Lucene/" style="font-size: 10px;">Lucene</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/Relay/" style="font-size: 10px;">Relay</a> <a href="/tags/StupidIE/" style="font-size: 10px;">StupidIE</a> <a href="/tags/Systemd/" style="font-size: 10px;">Systemd</a> <a href="/tags/full-text-search/" style="font-size: 10px;">full-text search</a> <a href="/tags/lucene/" style="font-size: 10px;">lucene</a> <a href="/tags/web前端/" style="font-size: 17.5px;">web前端</a> <a href="/tags/代码设计/" style="font-size: 10px;">代码设计</a> <a href="/tags/全文搜索/" style="font-size: 15px;">全文搜索</a> <a href="/tags/分布式算法/" style="font-size: 10px;">分布式算法</a> <a href="/tags/前端组件化/" style="font-size: 10px;">前端组件化</a> <a href="/tags/图片搜索/" style="font-size: 10px;">图片搜索</a> <a href="/tags/多线程/" style="font-size: 10px;">多线程</a> <a href="/tags/大数据/" style="font-size: 20px;">大数据</a> <a href="/tags/干货/" style="font-size: 10px;">干货</a> <a href="/tags/并发编程/" style="font-size: 12.5px;">并发编程</a> <a href="/tags/应用编排/" style="font-size: 10px;">应用编排</a> <a href="/tags/模块化/" style="font-size: 10px;">模块化</a> <a href="/tags/监控/" style="font-size: 10px;">监控</a> <a href="/tags/面向对象/" style="font-size: 10px;">面向对象</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="https://www.zhihu.com/people/wang-li-ran/activities">知乎</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2017 雨夜偷牛的人</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'https://leonlibraries.github.io/2017/06/15/Kubeadm搭建Kubernetes集群/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
